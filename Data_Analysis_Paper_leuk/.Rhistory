)
model_data$theta_logprior <- function(theta,prior_alpha = .5,prior_u = 3) {
lambda <- -log(prior_alpha)/prior_u
log(lambda/2) - lambda * exp(-theta/2) - theta/2
}
model_data$beta_logprec <- log(.05)
model_data$p <- 3
model_data$diffmat <- create_diff_matrix(model_data$n)
model_data$lambdainv <- create_full_dtcp_matrix(model_data$n)
model_data$Nd <- model_data$n - 1
model_data$Ne <- model_data$n
model_data$Wd <- model_data$M  + model_data$Nd + model_data$p
model_data$Wdf <- model_data$M  + model_data$Ne + model_data$p
model_data$times <- data$times
model_data$censoring <- data$censoring
model_data$entry <- data$entry
model_data$ID <- data$ID
model_data$diffmat <- create_diff_matrix(model_data$n)
model_data$lambdainv <- create_full_dtcp_matrix(model_data$n)
model_data$A$tpi$Ad <- model_data$diffmat %*% model_data$A$tpi$A
model_data$Xd <- model_data$diffmat %*% model_data$X
model_data$thetagrid <- mvQuad::createNIGrid(dim = 1,type = "GLe",level = 8)
mvQuad::rescale(model_data$thetagrid,domain = c(-2,18))
thetalist <- split(mvQuad::getNodes(model_data$thetagrid),rep(1:nrow(mvQuad::getNodes(model_data$thetagrid))))
# Random effect model specification data
model_data$modelspec <- model_data$A %>%
purrr::map("model") %>%
purrr::map2(.,names(.),~tibble(covariate = .y,model = .x)) %>%
purrr::reduce(bind_rows)
model_data$vectorofcolumnstoremove <- round(RW2BINS/2)
cat("Finished creating model data!\n")
#Optimization:
control1 <- list(
prec = 1e-08,
stop.trust.radius = 1e-10,
report.freq = 10,
report.level = 4,
start.trust.radius = 100,
contract.threshold = .25,
contract.factor = .5,
expand.factor = 3,
trust.iter = 2000,
maxit = 3000,
preconditioner = 0
)
tm <- proc.time()
sim1opt <- optimize_all_thetas_parallel(
theta = model_data$thetagrid,
model_data = model_data,
optcontrol = control1,
doparallel = PARALLEL_EXECUTION
)
rt <- proc.time() - tm
#Hyperparameter:Posterior
optresults_withlogpostpre <- add_log_posterior_values(sim1opt,model_data = model_data)
optresults_withlogpost <- normalize_optresults_logpost(optresults_withlogpostpre)
margpost1 <- marginal_hyperparameter_posterior(1,optresults_withlogpost)
priorfunc <- function(x) exp(model_data$theta_logprior(x))
priorfuncsigma <- function(x) (2/x) * exp(model_data$theta_logprior(-2*log(x)))
thetapostplot1 <- margpost1$margpost %>%
mutate(theta_post = exp(thetalogmargpost)) %>%
ggplot(aes(x = theta)) +
theme_classic() +
geom_line(aes(y = theta_post),colour = "red",size = 1) +
geom_line(aes(y = priorfunc(theta)),colour = "black",size = 0.5) +
labs(x = "",y = "") +
theme(text = element_text(size = 8))
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "red",size = 1) +
geom_line(aes(y = priorfuncsigma(sigma)),colour = "black",size = 0.5) +
labs(x = "",y = "") +
theme(text = element_text(size = 8))
log_posterior_sigma
sigmapostplot1
margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost))
margpost1$margpost %>%
mutate(theta_post = exp(thetalogmargpost))
source('~/Documents/GitHub/Paper-for-Cox-PH-Model/codes/01-functions.R')
set.seed(123)
options(mc.cores = 4L)
cores <- 4
RW2BINS <- 50
POLYNOMIAL_DEGREE <- 1
PARALLEL_EXECUTION <- TRUE
N <- 400
data <- sample_n(Leuk, N, replace = FALSE, weight = NULL, .env = NULL)
data <- data_frame(tpi=data$tpi,times = data$time, entry = rep(0,nrow(data)),censoring = data$cens, wbc = data$wbc, age = data$age, sex = data$sex)
data <- data %>% as_tibble() %>%
mutate(tpi_binned = bin_covariate(tpi,bins = RW2BINS,type = "quantile"))
data <- arrange_data(data)
data$ID <- 1:nrow(data)
Alist <- list()
Alist$tpi <- create_alist_element(data$tpi_binned)
model_data <- list(
A = Alist,
M = Alist %>% map("A") %>% map(ncol) %>% reduce(sum) - 1,
n = length(unique(data$ID)),
X = as.matrix(data_frame(sex = data$sex, age = data$age, wbc = data$wbc))
)
model_data$theta_logprior <- function(theta,prior_alpha = .5,prior_u = 3) {
lambda <- -log(prior_alpha)/prior_u
log(lambda/2) - lambda * exp(-theta/2) - theta/2
}
model_data$beta_logprec <- log(.05)
model_data$p <- 3
model_data$diffmat <- create_diff_matrix(model_data$n)
model_data$lambdainv <- create_full_dtcp_matrix(model_data$n)
model_data$Nd <- model_data$n - 1
model_data$Ne <- model_data$n
model_data$Wd <- model_data$M  + model_data$Nd + model_data$p
model_data$Wdf <- model_data$M  + model_data$Ne + model_data$p
model_data$times <- data$times
model_data$censoring <- data$censoring
model_data$entry <- data$entry
model_data$ID <- data$ID
model_data$diffmat <- create_diff_matrix(model_data$n)
model_data$lambdainv <- create_full_dtcp_matrix(model_data$n)
model_data$A$tpi$Ad <- model_data$diffmat %*% model_data$A$tpi$A
model_data$Xd <- model_data$diffmat %*% model_data$X
model_data$thetagrid <- mvQuad::createNIGrid(dim = 1,type = "GLe",level = 8)
mvQuad::rescale(model_data$thetagrid,domain = c(-2,18))
thetalist <- split(mvQuad::getNodes(model_data$thetagrid),rep(1:nrow(mvQuad::getNodes(model_data$thetagrid))))
# Random effect model specification data
model_data$modelspec <- model_data$A %>%
purrr::map("model") %>%
purrr::map2(.,names(.),~tibble(covariate = .y,model = .x)) %>%
purrr::reduce(bind_rows)
model_data$vectorofcolumnstoremove <- round(RW2BINS/2)
cat("Finished creating model data!\n")
#Optimization:
control1 <- list(
prec = 1e-08,
stop.trust.radius = 1e-10,
report.freq = 10,
report.level = 4,
start.trust.radius = 100,
contract.threshold = .25,
contract.factor = .5,
expand.factor = 3,
trust.iter = 2000,
maxit = 3000,
preconditioner = 0
)
tm <- proc.time()
sim1opt <- optimize_all_thetas_parallel(
theta = model_data$thetagrid,
model_data = model_data,
optcontrol = control1,
doparallel = F
)
rt <- proc.time() - tm
tm <- proc.time()
sim1opt <- optimize_all_thetas_parallel(
theta = model_data$thetagrid,
model_data = model_data,
optcontrol = control1,
doparallel = PARALLEL_EXECUTION
)
rt <- proc.time() - tm
sigma
sigma_pos <- exp(margpost1$margpost$sigmalogmargpost)
sigma_pos
margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost))
sim1opt
2/sigma
margpost1$margpost$thetalogmargpost
exp(margpost1$margpost$thetalogmargpost)
(2/sigma) * exp(margpost1$margpost$thetalogmargpost)
2/sigma
exp(margpost1$margpost$thetalogmargpost)
2/sigma * exp(margpost1$margpost$thetalogmargpost)
2/sigma [7,]
2/sigma [8,]
exp(margpost1$margpost$thetalogmargpost)[7]
exp(margpost1$margpost$thetalogmargpost)[8]
5863.369 * 0.00187106
13287.73 * 0.001159384
sigma[7]
1/0.0003411008
options(digits=5)
1/0.0003411008
options(digits=10)
1/0.0003411008
2/sigma [7,]
2/sigma * exp(margpost1$margpost$thetalogmargpost)
2/sigma
exp(margpost1$margpost$thetalogmargpost)
sum(exp(margpost1$margpost$thetalogmargpost))
set.seed(123)
options(mc.cores = 4L)
cores <- 4
RW2BINS <- 50
POLYNOMIAL_DEGREE <- 1
PARALLEL_EXECUTION <- TRUE
N <- 400
data <- sample_n(Leuk, N, replace = FALSE, weight = NULL, .env = NULL)
data <- data_frame(tpi=data$tpi,times = data$time, entry = rep(0,nrow(data)),censoring = data$cens, wbc = data$wbc, age = data$age, sex = data$sex)
data <- data %>% as_tibble() %>%
mutate(tpi_binned = bin_covariate(tpi,bins = RW2BINS,type = "quantile"))
data <- arrange_data(data)
data$ID <- 1:nrow(data)
Alist <- list()
Alist$tpi <- create_alist_element(data$tpi_binned)
model_data <- list(
A = Alist,
M = Alist %>% map("A") %>% map(ncol) %>% reduce(sum) - 1,
n = length(unique(data$ID)),
X = as.matrix(data_frame(sex = data$sex, age = data$age, wbc = data$wbc))
)
model_data$theta_logprior <- function(theta,prior_alpha = .5,prior_u = 3) {
lambda <- -log(prior_alpha)/prior_u
log(lambda/2) - lambda * exp(-theta/2) - theta/2
}
model_data$beta_logprec <- log(.05)
model_data$p <- 3
model_data$diffmat <- create_diff_matrix(model_data$n)
model_data$lambdainv <- create_full_dtcp_matrix(model_data$n)
model_data$Nd <- model_data$n - 1
model_data$Ne <- model_data$n
model_data$Wd <- model_data$M  + model_data$Nd + model_data$p
model_data$Wdf <- model_data$M  + model_data$Ne + model_data$p
model_data$times <- data$times
model_data$censoring <- data$censoring
model_data$entry <- data$entry
model_data$ID <- data$ID
model_data$diffmat <- create_diff_matrix(model_data$n)
model_data$lambdainv <- create_full_dtcp_matrix(model_data$n)
model_data$A$tpi$Ad <- model_data$diffmat %*% model_data$A$tpi$A
model_data$Xd <- model_data$diffmat %*% model_data$X
model_data$thetagrid <- mvQuad::createNIGrid(dim = 1,type = "GLe",level = 8)
mvQuad::rescale(model_data$thetagrid,domain = c(-2,15))
thetalist <- split(mvQuad::getNodes(model_data$thetagrid),rep(1:nrow(mvQuad::getNodes(model_data$thetagrid))))
# Random effect model specification data
model_data$modelspec <- model_data$A %>%
purrr::map("model") %>%
purrr::map2(.,names(.),~tibble(covariate = .y,model = .x)) %>%
purrr::reduce(bind_rows)
model_data$vectorofcolumnstoremove <- round(RW2BINS/2)
cat("Finished creating model data!\n")
#Optimization:
control1 <- list(
prec = 1e-08,
stop.trust.radius = 1e-10,
report.freq = 10,
report.level = 4,
start.trust.radius = 100,
contract.threshold = .25,
contract.factor = .5,
expand.factor = 3,
trust.iter = 2000,
maxit = 3000,
preconditioner = 0
)
tm <- proc.time()
sim1opt <- optimize_all_thetas_parallel(
theta = model_data$thetagrid,
model_data = model_data,
optcontrol = control1,
doparallel = PARALLEL_EXECUTION
)
rt <- proc.time() - tm
#Hyperparameter:Posterior
optresults_withlogpostpre <- add_log_posterior_values(sim1opt,model_data = model_data)
optresults_withlogpost <- normalize_optresults_logpost(optresults_withlogpostpre)
margpost1 <- marginal_hyperparameter_posterior(1,optresults_withlogpost)
priorfunc <- function(x) exp(model_data$theta_logprior(x))
priorfuncsigma <- function(x) (2/x) * exp(model_data$theta_logprior(-2*log(x)))
thetapostplot1 <- margpost1$margpost %>%
mutate(theta_post = exp(thetalogmargpost)) %>%
ggplot(aes(x = theta)) +
theme_classic() +
geom_line(aes(y = theta_post),colour = "red",size = 1) +
geom_line(aes(y = priorfunc(theta)),colour = "black",size = 0.5) +
labs(x = "",y = "") +
theme(text = element_text(size = 8))
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "red",size = 1) +
geom_line(aes(y = priorfuncsigma(sigma)),colour = "black",size = 0.5) +
labs(x = "",y = "") +
theme(text = element_text(size = 8))
set.seed(123)
cores <- 4
RW2BINS <- 50
PARALLEL_EXECUTION <- TRUE
data <- kidney
data <- data_frame(times = data$time, entry = rep(0,nrow(data)),censoring = data$status, age = data$age, sex = data$sex, disease = data$disease, id = data$id)
data$disease <- relevel(data$disease,ref = "Other")
data <- arrange_data(data)
data$ID <- 1:nrow(data)
xdata <- data.frame(age = data$age,sex = data$sex,GN = ifelse(data$disease == "GN",1,0),AN = ifelse(data$disease == "AN",1,0),PKD = ifelse(data$disease == "PKD",1,0))
Blist <- list()
Blist$id <- create_blist_element(data$id)
iidnum <- Blist %>% map("B") %>% map(ncol) %>% reduce(sum)
model_data <- list(
X=as.matrix(xdata),
B = Blist,
M = iidnum,
n = length(unique(data$ID)),
Nd = length(unique(data$ID))-1
)
model_data$beta_logprec <- log(.05)
model_data$diffmat <- create_diff_matrix(model_data$n)
model_data$lambdainv <- create_full_dtcp_matrix(model_data$n)
model_data$Xd <- model_data$diffmat %*% model_data$X
model_data$B$id$Bd <- model_data$diffmat %*% model_data$B$id$B
model_data$p <- ncol(model_data$X)
model_data$Ne <- model_data$n
model_data$Wd <- model_data$M + model_data$p + model_data$Nd
model_data$Wdf <- model_data$M + model_data$p + model_data$Ne
model_data$times <- data$times
model_data$censoring <- data$censoring
model_data$entry <- data$entry
model_data$ID <- data$ID
model_data$theta_logprior <- function(theta,prior_alpha = c(.5),prior_u = c(2)) {
# In this model, theta is the LOG PRECISION of the rw2 smoothing variance
# Implement the PC prior directly.
# P(sigma > u) = alpha.
# See inla.doc("pc.prec")
lambda <- -log(prior_alpha)/prior_u
log(lambda/2) - lambda * exp(-theta/2) - theta/2
}
model_data$thetagrid <- mvQuad::createNIGrid(dim = 1,type = "GLe",level = 50)
mvQuad::rescale(model_data$thetagrid,domain = c(-1,8))
thetalist <- split(mvQuad::getNodes(model_data$thetagrid),rep(1:nrow(mvQuad::getNodes(model_data$thetagrid))))
# Random effect model specification data
model_data$modelspec <- model_data$B %>%
purrr::map("model") %>%
purrr::map2(.,names(.),~tibble(covariate = .y,model = .x)) %>%
purrr::reduce(bind_rows)
cat("Finished creating model data!\n")
#Optimization:
control1 <- list(
prec = 1e-08,
stop.trust.radius = 1e-10,
report.freq = 10,
report.level = 4,
start.trust.radius = 100,
contract.threshold = .25,
contract.factor = .5,
expand.factor = 3,
trust.iter = 2000,
maxit = 3000,
preconditioner = 0
)
tm <- proc.time()
sim1opt <- optimize_all_thetas_parallel(
theta = model_data$thetagrid,
model_data = model_data,
optcontrol = control1,
doparallel = PARALLEL_EXECUTION
)
rt <- proc.time() - tm
# Plots of marginal posteriors for hyperparameter
optresults_withlogpostpre <- add_log_posterior_values(sim1opt,model_data = model_data)
optresults_withlogpost <- normalize_optresults_logpost(optresults_withlogpostpre)
margpost1 <- marginal_hyperparameter_posterior(1,optresults_withlogpost)
priorfunc <- function(x) exp(model_data$theta_logprior(x))
priorfuncsigma <- function(x) (2/x) * exp(model_data$theta_logprior(-2*log(x)))
thetapostplot1 <- margpost1$margpost %>%
mutate(theta_post = exp(thetalogmargpost)) %>%
ggplot(aes(x = theta)) +
theme_classic() +
geom_line(aes(y = theta_post),colour = "red",size = 1) +
geom_line(aes(y = priorfunc(theta)),colour = "black",size = 0.5) +
labs(x = "",y = "") +
theme(text = element_text(size = 8))
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "black",linetype = "solid",size = 1) +
labs(x = "",y = "") +
geom_line(aes(y = priorfuncsigma(sigma)),colour = 'black',linetype = 'dashed',size = 0.5) +
theme(text = element_text(size = 8))
sigmapostplot1
thetapostplot1
# Compare with INLA:
data$GN <- xdata$GN
data$AN <- xdata$AN
data$PKD <- xdata$PKD
prior.prec <- list(prec = list(prior = "pc.prec",
param = c(2, 0.5)))
formula <- inla.surv(times,censoring) ~ age + sex + GN + AN + PKD + f(id,model = 'iid',hyper = prior.prec)
Inlaresult <- inla(formula = formula, control.compute = list(dic=TRUE),control.inla = list(strategy = 'gaussian',int.strategy = 'grid'), control.fixed = list(prec = 0.05), data = data, family = "coxph")
Inlaresult$summary.fixed[,1][-1]
Inlaresult$summary.random$id[,1:2]$mean
Inlaresult
Inlaresult$summary.hyperpar$mean
Inlaresult$marginals.hyperpar$`Precision for id`
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "black",linetype = "solid",size = 1) +
labs(x = "",y = "") +
geom_line(aes(y = priorfuncsigma(sigma)),colour = 'black',linetype = 'dashed',size = 0.5) +
theme_classic()
sigmapostplot1
Inlaresult$marginals.hyperpar$`Precision for id`[,2]
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "black",linetype = "solid",size = 1) +
labs(x = "",y = "") +
geom_line(aes(y = priorfuncsigma(sigma)),colour = 'black',linetype = 'dashed',size = 0.5) +
geom_line(aes(y = Inlaresult$marginals.hyperpar$`Precision for id`[,2], x = Inlaresult$marginals.hyperpar$`Precision for id`[,1]),colour = 'black',linetype = 'dashed',size = 0.5)
theme_classic()
sigmapostplot1
priorfuncsigma(sigma)
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "black",linetype = "solid",size = 1) +
labs(x = "",y = "") +
geom_line(aes(y = priorfuncsigma(sigma)),colour = 'black',linetype = 'dashed',size = 0.5) +
theme_classic()
sigmapostplot1
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "black",linetype = "solid",size = 1) +
labs(x = "",y = "") +
geom_line(aes(y = priorfuncsigma(sigma)),colour = 'black',linetype = 'dashed',size = 0.5) +
geom_line(aes(data = Inlaresult$marginals.hyperpar$`Precision for id`, y = y, x=x),colour = 'black',linetype = 'dashed',size = 0.5) +
theme_classic()
sigmapostplot1
Inlaresult$marginals.hyperpar$`Precision for id`
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "black",linetype = "solid",size = 1) +
labs(x = "",y = "") +
geom_line(aes(y = priorfuncsigma(sigma)),colour = 'black',linetype = 'dashed',size = 0.5) +
geom_line(data = Inlaresult$marginals.hyperpar$`Precision for id`, aes(y = y, x = x),colour = 'black',linetype = 'dashed',size = 0.5) +
theme_classic()
as.dataframe(Inlaresult$marginals.hyperpar$`Precision for id`)
dataframe(Inlaresult$marginals.hyperpar$`Precision for id`)
data_frame(Inlaresult$marginals.hyperpar$`Precision for id`)
datainla <- data_frame(Inlaresult$marginals.hyperpar$`Precision for id`)
names(datainla)
names(datainla) <- c("x","y")
datainla <- data_frame(Inlaresult$marginals.hyperpar$`Precision for id`)
Inlaresult$marginals.hyperpar$`Precision for id`
Inlaresult$marginals.hyperpar$`Precision for id`$x
Inlaresult$marginals.hyperpar$`Precision for id`[,1]
datainla <- data_frame(x = Inlaresult$marginals.hyperpar$`Precision for id`[,1],x = Inlaresult$marginals.hyperpar$`Precision for id`[,2])
datainla <- data_frame(x = Inlaresult$marginals.hyperpar$`Precision for id`[,1],y = Inlaresult$marginals.hyperpar$`Precision for id`[,2])
datainla
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "black",linetype = "solid",size = 1) +
labs(x = "",y = "") +
geom_line(aes(y = priorfuncsigma(sigma)),colour = 'black',linetype = 'dashed',size = 0.5) +
geom_line(data = datainla, aes(y = y, x = x),colour = 'black',linetype = 'dashed',size = 0.5) +
theme_classic()
sigmapostplot1
datainla
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "black",linetype = "solid",size = 1) +
labs(x = "",y = "") +
geom_line(aes(y = priorfuncsigma(sigma)),colour = 'black',linetype = 'dashed',size = 0.5) +
geom_line(data = datainla, aes(y = x, x = y),colour = 'black',linetype = 'dashed',size = 0.5) +
theme_classic()
sigmapostplot1
datainla
datainla <- data_frame(x = Inlaresult$marginals.hyperpar$`Precision for id`[,1],y = Inlaresult$marginals.hyperpar$`Precision for id`[,2])
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "black",linetype = "solid",size = 1) +
labs(x = "",y = "") +
geom_line(aes(y = priorfuncsigma(sigma)),colour = 'black',linetype = 'dashed',size = 0.5) +
geom_line(data = datainla, aes(x = x, y = y),colour = 'black',linetype = 'dashed',size = 0.5) +
theme_classic()
sigmapostplot1
x
datainla$x
datainla$y
brinla::bri.hyperpar.plot(Inlaresult)
Inlaresult$marginals.hyperpar
datainla <- data_frame(x = Inlaresult$marginals.hyperpar$`Precision for id`[,1][2:42],y = Inlaresult$marginals.hyperpar$`Precision for id`[,2][2:42])
sigmapostplot1 <- margpost1$margpost %>%
mutate(sigma_post = exp(sigmalogmargpost)) %>%
ggplot(aes(x = sigma)) +
theme_classic() +
geom_line(aes(y = sigma_post),colour = "black",linetype = "solid",size = 1) +
labs(x = "",y = "") +
geom_line(aes(y = priorfuncsigma(sigma)),colour = 'black',linetype = 'dashed',size = 0.5) +
geom_line(data = datainla, aes(x = x, y = y),colour = 'black',linetype = 'dashed',size = 0.5) +
theme_classic()
sigmapostplot1
Inlaresult$marginals.hyperpar$`Precision for id`
Inlaresult$summary.hyperpar$mean
Inlaresult$marginals.hyperpar$`Precision for id`
